# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç—É

–î–æ–¥–∞—Ç–æ–∫ –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ –±–∞–∑—ñ **React (Vite)** –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º **TypeScript**. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –æ–ø–∏—Å –æ—Å–Ω–æ–≤–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π —Ç–∞ —Ñ–∞–π–ª—ñ–≤.

## üìÅ –ö–æ—Ä–µ–Ω–µ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

*   `index.html` ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É, –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ —Ç–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤ (Google GSI, PeerJS).
*   `App.tsx` ‚Äî –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—ñ–≤ (Setup -> Creation -> Game), —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—ñ–≤.
*   `types.ts` ‚Äî –ì–ª–æ–±–∞–ª—å–Ω—ñ TypeScript —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ (Character, Message, CombatState, MapToken —Ç–æ—â–æ).

## üìÇ /components (UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø–æ–¥—ñ–ª–µ–Ω—ñ –∑–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º:

### –û—Å–Ω–æ–≤–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
*   `CharacterSheet.tsx` ‚Äî –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å—Ç–∞—Ç–∏, —ñ–Ω–≤–µ–Ω—Ç–∞—Ä, –∑–∞–∫–ª—è—Ç—Ç—è).
*   `GameSetup.tsx` ‚Äî –ï–∫—Ä–∞–Ω–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –≤–∏–±–æ—Ä—É —Ä–µ–∂–∏–º—É –≥—Ä–∏ (Host/Client).
*   `DiceRoller.tsx` ‚Äî –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∏–¥–∫—ñ–≤ –∫—É–±–∏–∫—ñ–≤ (SVG + CSS –∞–Ω—ñ–º–∞—Ü—ñ—ó).
*   `Typewriter.tsx` ‚Äî –ï—Ñ–µ–∫—Ç –¥—Ä—É–∫–∞—Ä—Å—å–∫–æ—ó –º–∞—à–∏–Ω–∫–∏ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –®–Ü.

### –ë–æ–π–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–∞ –ú–∞–ø–∞
*   `BattleMap.tsx` ‚Äî –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–∏ (Canvas + DOM). –û–±—Ä–æ–±–ª—è—î —Ç—É–º–∞–Ω –≤—ñ–π–Ω–∏, –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è, –º–∞–ª—é–≤–∞–Ω–Ω—è.
*   `CombatTracker.tsx` ‚Äî –í—ñ–¥–∂–µ—Ç —ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–∏ —Ç–∞ —Å—Ç–∞–Ω—ñ–≤.
*   `CombatActionsPanel.tsx` ‚Äî –ü–∞–Ω–µ–ª—å –¥—ñ–π –≥—Ä–∞–≤—Ü—è (–ê—Ç–∞–∫–∞, –ó–∞–∫–ª—è—Ç—Ç—è, –†–∏–≤–æ–∫).
*   `VisualFX.tsx` ‚Äî –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏–Ω–æ–∫ (–≤–æ–≥–æ–Ω—å, –∫—Ä–æ–≤, –ø–æ–≥–æ–¥–∞) –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–∏.

### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ –ú–µ–Ω—é
*   `DMTools.tsx` ‚Äî –ü–∞–Ω–µ–ª—å –ú–∞–π—Å—Ç—Ä–∞ (–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è NPC, –ª—É—Ç—É, –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø–æ–≥–æ–¥–æ—é).
*   `LobbyPanel.tsx` ‚Äî –õ–æ–±—ñ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–∞, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ.
*   `Journal.tsx` / `Compendium.tsx` / `AdventureLog.tsx` ‚Äî –î–æ–≤—ñ–¥–Ω–∏–∫–∏, –∫–≤–µ—Å—Ç–∏, —ñ—Å—Ç–æ—Ä—ñ—è.
*   `MerchantShop.tsx` ‚Äî –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–∞–≥–∞–∑–∏–Ω—É –∑ –®–Ü-–≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é —Ç–æ–≤–∞—Ä—ñ–≤.
*   `CloudSaves.tsx` / `HomebrewManager.tsx` ‚Äî –ú–µ–Ω–µ–¥–∂–µ—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—å —Ç–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É.

## üìÇ /services (–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ —Ç–∞ API)

*   `geminiService.ts` ‚Äî **–Ø–¥—Ä–æ –®–Ü.** –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç–∞, —á–µ—Ä–≥–∞ –∑–∞–ø–∏—Ç—ñ–≤, –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ (`dmTools`), –ª–æ–≥—ñ–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–µ–∫—Å—Ç—É/–∑–æ–±—Ä–∞–∂–µ–Ω—å.
*   `peerService.ts` ‚Äî **–ú–µ—Ä–µ–∂–∞.** –û–±–≥–æ—Ä—Ç–∫–∞ –Ω–∞–¥ PeerJS. –ö–µ—Ä—É—î –∑'—î–¥–Ω–∞–Ω–Ω—è–º–∏, —Ä—É–∫–æ—Å—Ç–∏—Å–∫–∞–Ω–Ω—è–º–∏, —Ç–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –¥–∞–Ω–∏—Ö (`PeerData`).
*   `googleDriveService.ts` ‚Äî –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Drive API –¥–ª—è —Ö–º–∞—Ä–Ω–∏—Ö –∑–±–µ—Ä–µ–∂–µ–Ω—å.
*   `dndApiService.ts` ‚Äî –ö–ª—ñ—î–Ω—Ç –¥–ª—è D&D 5e API (–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–∫–ª—è—Ç—å, –º–æ–Ω—Å—Ç—Ä—ñ–≤).
*   `firebaseService.ts` ‚Äî (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –±–µ–∫–µ–Ω–¥ –¥–ª—è —Å–µ—Å—ñ–π.

## üìÇ /utils (–£—Ç–∏–ª—ñ—Ç–∏)

*   `mechanics.ts` ‚Äî –ß–∏—Å—Ç–∞ –ª–æ–≥—ñ–∫–∞ D&D 5e (—Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤, AC, –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–π—Å—ñ–≤).
*   `geometry.ts` ‚Äî –ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –¥–ª—è **Fog of War** (Raycasting, –ø–µ—Ä–µ—Ç–∏–Ω –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤).
*   `particleSystem.ts` ‚Äî –§—ñ–∑–∏–∫–∞ —á–∞—Å—Ç–∏–Ω–æ–∫ –¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞ Canvas.
*   `audioSynth.ts` ‚Äî Web Audio API —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –∑–≤—É–∫—ñ–≤ (–ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ñ SFX).

## üìÇ /contexts (React Context)

*   `AudioContext.tsx` ‚Äî –ö–µ—Ä—É–≤–∞–Ω–Ω—è –º—É–∑–∏–∫–æ—é, –µ–º–±—ñ—î–Ω—Ç–æ–º —Ç–∞ SFX.
*   `ThemeContext.tsx` ‚Äî –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è (Fantasy, Sci-Fi).

## üìÇ /data

*   `spells.ts` ‚Äî –õ–æ–∫–∞–ª—å–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –±–∞–∑–æ–≤–∏—Ö –∑–∞–∫–ª—è—Ç—å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.

---

## –ü–æ—Ç—ñ–∫ –î–∞–Ω–∏—Ö (Data Flow)

1.  **User Action:** –ì—Ä–∞–≤–µ—Ü—å –Ω–∞—Ç–∏—Å–∫–∞—î "–ê—Ç–∞–∫–∞".
2.  **App State:** `App.tsx` –æ–Ω–æ–≤–ª—é—î –ª–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω (–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç).
3.  **AI Processing (Host Only):** –Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –•–æ—Å—Ç (–∞–±–æ Single), –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–¥–∞—î—Ç—å—Å—è –≤ `Action Buffer`.
4.  **Gemini Request:** `geminiService.ts` –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –±—É—Ñ–µ—Ä –¥—ñ–π + –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω—É (`getGameStateContext`) –¥–æ API.
5.  **Tool Execution:** Gemini –ø–æ–≤–µ—Ä—Ç–∞—î –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `request_roll`). –î–æ–¥–∞—Ç–æ–∫ –≤–∏–∫–æ–Ω—É—î —ó—ó —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
6.  **Sync (Multiplayer):** –Ø–∫—â–æ –≥—Ä–∞ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–Ω–∞, –•–æ—Å—Ç —Ä–æ–∑—Å–∏–ª–∞—î –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞–Ω (`STATE_SYNC` –∞–±–æ `DELTA_UPDATE`) —á–µ—Ä–µ–∑ `peerService.ts` –≤—Å—ñ–º –∫–ª—ñ—î–Ω—Ç–∞–º.